(self.AMP=self.AMP||[]).push({n:"amp-user-notification",v:"1512677960104",f:(function(AMP){var g;function k(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]};Date.now();function l(a){for(var b=null,c="",d=0;d<arguments.length;d++){var e=arguments[d];if(e instanceof Error&&!b){var b=void 0,h=e.message,f=String(Math.random());e.message=f;if(e.message===f)e.message=h,b=e;else{h=Error(e.message);for(b in e)h[b]=e[b];h.stack=e.stack;b=h}}else c&&(c+=" "),c+=e}b?c&&(b.message=c+": "+b.message):b=Error(c);return b}function n(a){var b=l.apply(null,arguments);setTimeout(function(){self.reportError(b);throw b;})}self.log=self.log||{user:null,dev:null,userForEmbed:null}; var p=self.log;function q(){if(!p.user)throw Error("failed to call initLogConstructor");return p.user}function r(){if(p.dev)return p.dev;throw Error("failed to call initLogConstructor");};function t(a){return a||{}};function u(a){if(a.nodeType){var b=(a.ownerDocument||a).defaultView;if(b=b!=(b.__AMP_TOP||b)&&v(b,"url-replace")?w(b,"url-replace"):null)return b}return x(a,"url-replace")}function y(a,b){a=a.__AMP_TOP||a;return w(a,b)}function x(a,b){a=A(a);a=B(a);return w(a,b)}function A(a){return a.nodeType?y((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function B(a){a=A(a);return a.isSingleDoc()?a.win:a} function w(a,b){v(a,b);var c=C(a);a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function D(a,b){var c=E(a,b);if(c)return c;var d,e=new Promise(function(a){d=a});C(a)[b]={obj:null,promise:e,resolve:d,context:null,ctor:null};return e}function E(a,b){var c=C(a)[b];if(c){if(c.promise)return c.promise;w(a,b);return c.promise=Promise.resolve(c.obj)}return null}function C(a){var b=a.services;b||(b=a.services={});return b} function v(a,b){a=a.services&&a.services[b];return!(!a||!a.ctor&&!a.obj)};/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */ var F,G; function H(a){if("string"==typeof a){F||(F=self.document.createElement("a"),G=self.UrlCache||(self.UrlCache=Object.create(null)));var b=G[a];if(b)a=b;else{b=F;b.href=a;b.protocol||(b.href=b.href);var c={href:b.href,protocol:b.protocol,host:b.host,hostname:b.hostname,port:"0"==b.port?"":b.port,pathname:b.pathname,search:b.search,hash:b.hash,origin:null};"/"!==c.pathname[0]&&(c.pathname="/"+c.pathname);if("http:"==c.protocol&&80==c.port||"https:"==c.protocol&&443==c.port)c.port="",c.host=c.hostname;c.origin= b.origin&&"null"!=b.origin?b.origin:"data:"!=c.protocol&&c.host?c.protocol+"//"+c.host:c.href;a=G[a]=c}}(b="https:"==a.protocol||"localhost"==a.hostname)||(a=a.hostname,b=a.length-10,b=0<=b&&a.indexOf(".localhost",b)==b);return b}function I(a,b){var c;c=void 0===c?"source":c;q().assert(null!=a,"%s %s must be available",b,c);var d=a;q().assert(H(d)||/^(\/\/)/.test(d),'%s %s must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',b,c,d)};var J,K="Webkit webkit Moz moz ms O o".split(" ");function L(a){var b;b=AMP.BaseElement.call(this,a)||this;b.m=null;b.b=null;b.h=null;b.o=new Promise(function(a){b.h=a});b.a=null;b.i=!1;b.c=null;b.j="";b.l=null;b.B=null;return b}k(L,AMP.BaseElement);g=L.prototype;g.isAlwaysFixed=function(){return!0}; g.buildCallback=function(){var a=this,b=this.getAmpDoc();this.B=u(b);this.l=D(B(b),"storage");this.b=q().assert(this.element.id,"amp-user-notification should have an id.");this.j="amp-user-notification:"+this.b;(this.c=this.element.getAttribute("data-show-if-href"))&&I(this.c,this.element);(this.a=this.element.getAttribute("data-dismiss-href"))&&I(this.a,this.element);var c=this.element.getAttribute("role");c||this.element.setAttribute("role","alert");var d=this.element.getAttribute("data-persist-dismissal"); this.i="false"!=d&&"no"!=d;this.registerAction("dismiss",function(){return a.dismiss(!1)});this.registerAction("optoutOfCid",function(){return M(a)});var e=D(B(b),"userNotificationManager");e.then(function(b){b.registerUserNotification(a.b,a)})}; function N(a,b){var c=a.c;return a.B.expandAsync(c).then(function(c){var e;e={elementId:a.b,ampUserId:b};var d=[],f;for(f in e){var m=e[f];if(null!=m)if(Array.isArray(m))for(var z=0;z<m.length;z++){var Q=m[z];d.push(encodeURIComponent(f)+"="+encodeURIComponent(Q))}else d.push(encodeURIComponent(f)+"="+encodeURIComponent(m))}e=d.join("&");d=c;e?(d=d.split("#",2),f=d[0].split("?",2),e=f[0]+(f[1]?"?"+f[1]+"&"+e:"?"+e),e+=d[1]?"#"+d[1]:""):e=d;return e})} g.C=function(a){var b=this;this.m=a;return N(this,a).then(function(a){var c={credentials:"include",requireAmpResponseSourceOrigin:!1};return y(b.win,"xhr").fetchJson(a,c).then(function(a){return a.json()})})};function O(a){var b=a.element.getAttribute("enctype")||"application/json;charset=utf-8";y(a.win,"xhr").fetchJson(a.a,{method:"POST",credentials:"include",requireAmpResponseSourceOrigin:!1,body:t({elementId:a.b,ampUserId:a.m}),headers:{"Content-Type":b}})} g.D=function(a){q().assert("boolean"==typeof a.showNotification,'`showNotification` should be a boolean. Got "%s" which is of type %s.',a.showNotification,typeof a.showNotification);a.showNotification||this.h();return Promise.resolve(a.showNotification)};function M(a){return D(B(a.element),"cid").then(function(a){return a.optOut()}).then(function(){return a.dismiss(!1)},function(b){r().error("amp-user-notification","Failed to opt out of Cid",b);a.dismiss(!0)})} function P(a){return D(B(a.element),"cid").then(function(b){return b.get({scope:"amp-user-notification",createCookieIfNotPresent:!0},Promise.resolve(),a.o)})}g.shouldShow=function(){var a=this;return this.isDismissed().then(function(b){return b?!1:a.c?P(a).then(a.C.bind(a)).then(a.D.bind(a)):!0})}; g.show=function(){var a=this.element,b;b=a.style;J||(J=Object.create(null));var c=J.display;if(!c){c="display";if(void 0===b.display){var d;b:{for(d=0;d<K.length;d++){var e=K[d]+"Display";if(void 0!==b[e]){d=e;break b}}d=""}void 0!==b[d]&&(c=d)}J.display=c}b=c;b&&(a.style[b]="");this.element.classList.add("amp-active");this.getViewport().addToFixedLayer(this.element);return this.o}; g.isDismissed=function(){var a=this;return this.i?this.l.then(function(b){return b.get(a.j)}).then(function(a){return!!a},function(a){r().error("amp-user-notification","Failed to read storage",a);return!1}):Promise.resolve(!1)};g.activate=function(){this.dismiss(!1)}; g.dismiss=function(a){var b=this;this.element.classList.remove("amp-active");this.element.classList.add("amp-hidden");this.h();this.getViewport().removeFromFixedLayer(this.element);this.i&&!a&&this.l.then(function(a){a.set(b.j,!0)});this.a&&O(this)};function R(a){this.ampdoc=a;this.A=Object.create(null);this.g=Object.create(null);this.F=x(this.ampdoc,"viewer");this.s=this.ampdoc.whenReady();this.w=this.u=Promise.all([this.F.whenFirstVisible(),this.s])} R.prototype.get=function(a){var b=this;this.u.then(function(){null==b.ampdoc.getElementById(a)&&q().warn("amp-user-notification","Did not find amp-user-notification element "+a+".")});return S(this,a).promise};R.prototype.getNotification=function(a){var b=this;return this.s.then(function(){return b.A[a]})}; R.prototype.registerUserNotification=function(a,b){this.A[a]=b;var c=S(this,a);return this.w=this.w.then(function(){return b.shouldShow().then(function(a){if(a)return b.show()})}).then(c.resolve.bind(this,b)).catch(n.bind(null,"Notification service failed amp-user-notification",a))};function S(a,b){if(a.g[b])return a.g[b];var c,d=new Promise(function(a){c=a});return a.g[b]={promise:d,resolve:c}} (function(a){a.registerServiceForDoc("userNotificationManager",R);a.registerElement("amp-user-notification",L,"amp-user-notification{position:fixed!important;bottom:70;left:0;overflow:hidden!important;visibility:hidden;background:hsla(0,0%,100%,.7);z-index:1000;width:100%}amp-user-notification.amp-active{visibility:visible}amp-user-notification.amp-hidden{visibility:hidden}\n/*# sourceURL=/extensions/amp-user-notification/0.1/amp-user-notification.css*/")})(self.AMP); })}); //# sourceMappingURL=https://cdn.ampproject.org/v0/amp-user-notification-0.1.js.map
